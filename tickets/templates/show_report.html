<!DOCTYPE html>
<html>
<head>
	{% include 'favicon.html' %}
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>NT Tickets</title>
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link href="{{ STATIC_URL }}stylesheets/materialize.css" rel="stylesheet" />
	<link href="{{ STATIC_URL }}stylesheets/style.css" rel="stylesheet" />
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="{{ STATIC_URL }}js/bin/materialize.js"></script>
</head>
<body id="background">
	<header>
		<div class="navbar-fixed">
			<nav>
			    <div class="nav-wrapper">
			     	<a href="/" class="brand-logo center">
			     	<img src="{{ STATIC_URL }}images/nnt_tickets_white.png" id="nav-logo">
			     	</a>
			     	<div class="nav-container">
				     	<ul id="nav-mobile" class="left hide-on-med-and-down">
				        	<li><a href="/">Home</a></li>
				        	<li><a href="/report">Sale Reports</a></li>
				      	</ul>
				      	<ul id="nav-mobile" class="right hide-on-med-and-down">
				      		<li><a href="/admin">Admin Login</a></li>
				      	</ul>
			      	</div>
			    </div>
			</nav>
		</div>
	</header>
	<main>
	<div class="container">
		<div class="row">
			<div class="col s12">
				<div class="card small grey darken-3">
					<a href="{{ show.id }}" rel="nofollow"></a>
					<div class="row">
						<div class="col s4 m3 l2">
							<div class="card-image">
								{% if show.poster_page %}
									<img class="responsive-img" src="{{ show.poster_page.url }}" id="report-image">
								{% else %}
									<img class="responsive-img" src="{{ STATIC_URL }}images/no_image.png" id="report-image">
								{% endif %}
							</div>
						</div>
						<div class="col s8 m9 l9">
							<div class="card-content">
								<h1 class="light white-text flow-text">
								{{ show.name }} 
								{% if report.have_form %} 
								on <strong>{{ report.day }}</strong> at <strong>{{ report.time }}</strong> 
								{% endif %}
								</h1>
								<button data-target="picker-modal" class="btn nnt purple modal-trigger waves-effect waves-light">Choose Showing</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		{% if report.have_form %}

		<div class="row">
			<div class="col s12">
				<div class="card tiny grey darken-3">
					<div class="card-content">
						<p class="center-align light white-text flow-text">
						{% if report.sold == 0 %}
							No tickets have been sold yet
						{% elif report.sold == 1 %}
							There has been <span class="nnt-purple bold">{{ report.sold }}</span> ticket sold
						{% else %}
							There have been <span class="nnt-purple bold">{{ report.sold }}</span> tickets sold
						{% endif %}
						</p>

						<p class="center-align light white-text flow-text">
						{% if report.how_many_sold == 0 %}
							Huh, there are no tickets reserved! Maybe someone needs to publicise more!
						{% elif report.how_many_sold == 1 %}
							There is <span class="nnt-orange bold">{{ report.how_many_reserved }}</span> ticket reserved, 
						{% else %}
							There are <span class="nnt-orange bold">{{ report.how_many_reserved }}</span> tickets reserved, 
						{% endif %}

						leaving <span class="bold">{{ report.how_many_left }}</span> tickets left 
						out of <span class="bold">{{ report.max }}</span>.
						</p>
						<div class="progress" id="report-bar">
							{% if report.sale_percentage >= report.reserve_percentage %}
							<div class="determinate" style="width: {{ report.sale_percentage }}%" id="sale-percentage"></div>
					     	<div class="determinate" style="width: {{ report.reserve_percentage }}%"></div>
					     	{% else %}
				     		<div class="determinate" style="width: {{ report.reserve_percentage }}%"></div>
			     			<div class="determinate" style="width: {{ report.sale_percentage }}%" id="sale-percentage"></div>
					      	{% endif %}
					  </div>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<form class="col s12" action="." method="post">
			{% csrf_token %}
				<div class="row" id="form-background">
					<div class="input-field col s9">
						<input name="{{ S_form.ticket.name }}" type="text" class="validate" value="{{ report.reservation }}">
						<label for="{{ S_form.ticket.name }}">{{ S_form.ticket.label }}</label>
					</div>

					<div class="col s3" id="form-button-inline">
						<button class="btn nnt purple waves-effec waves-light modal-trigger" href="#modal2">Reservation</button>
					</div>

					<!-- Hidden inputs for ticket prices -->
					<div class="input-field col s12">	
						<input type="hidden" value="{{ report.concession_price }}" id="concession_price">
						<input type="hidden" value="{{ report.public_price }}" id="public_price">
						<input type="hidden" value="{{ report.fringe_price }}" id="fringe_price">
						<input type="hidden" value="{{ report.external_price }}" id="external_price">
						<input type="hidden" value="{{ report.matinee_freshers_price }}" id="matinee_freshers_price">
						<input type="hidden" value="{{ report.matinee_freshers_nnt_price }}" id="matinee_freshers_nnt_price">
					</div>
					{% if report.category|stringformat:"s" == "In House" %}
						<div class="input-field col s3">
							<input name="{{ S_form.number_concession.name }}" id="concession" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_concession.name }}">{{ S_form.number_concession.label }}</label>
						</div>

						<div class="input-field col s3">
							<input name="{{ S_form.number_public.name }}" id="public" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_public.name }}">{{ S_form.number_public.label }}</label>
						</div>

						<div class="input-field col s3">
							<input name="{{ S_form.number_season.name }}" id="season" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_season.name }}">{{ S_form.number_season.label }}</label>
						</div>

						<div class="input-field col s3">
							<input name="{{ S_form.number_fellow.name }}" id="fellow" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_fellow.name }}">{{ S_form.number_fellow.label }}</label>
						</div>
					{% if report.time|stringformat:"s" == report.default_time %}
						<div class="col s12">
							<input name="{{ S_form.number_fringe.name }}" id="fringe" type="hidden" value="0">
							<input name="{{ S_form.number_external.name }}" id="external" type="hidden" value="0">
							<input name="{{ S_form.number_matinee_freshers.name }}" id="matinee_freshers" type="hidden" value="0">
							<input name="{{ S_form.number_matinee_freshers_nnt.name }}" id="matinee_freshers_nnt" type="hidden" value="0">
						</div>
					{% elif report.time|stringformat:"s" == report.default_time_matinee %}
						<div class="input-field col s6">
							<input name="{{ S_form.number_matinee_freshers.name }}" id="matinee_freshers" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_matinee_freshers.name }}">{{ S_form.number_matinee_freshers.label }}</label>
						</div>

						<div class="input-field col s6">
							<input name="{{ S_form.number_matinee_freshers_nnt.name }}" id="matinee_freshers_nnt" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_matinee_freshers_nnt.name }}">{{ S_form.number_matinee_freshers_nnt.label }}</label>
						</div>

						<div class="col s12">
							<input name="{{ S_form.number_fringe.name }}" id="fringe" type="hidden" value="0">
							<input name="{{ S_form.number_external.name }}" id="external" type="hidden" value="0">
						</div>
					{% endif %}
					{% elif report.category|stringformat:"s" == "Fringe" %}
						<div class="input-field col s6">
							<input name="{{ S_form.number_fringe.name }}" id="fringe" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_fringe.name }}">{{ S_form.number_fringe.label }}</label>
						</div>

						<div class="input-field col s3">
							<input name="{{ S_form.number_season.name }}" id="season" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_season.name }}">{{ S_form.number_season.label }}</label>
						</div>

						<div class="input-field col s3">
							<input name="{{ S_form.number_fellow.name }}" id="fellow" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_fellow.name }}">{{ S_form.number_fellow.label }}</label>
						</div>

						<div class="col s12">
							<input name="{{ S_form.number_concession.name }}" id="concession" type="hidden" value="0">
							<input name="{{ S_form.number_public.name }}" id="public" type="hidden" value="0">
							<input name="{{ S_form.number_external.name }}" id="external" type="hidden" value="0">
							<input name="{{ S_form.number_matinee_freshers.name }}" id="matinee_freshers" type="hidden" value="0">
							<input name="{{ S_form.number_matinee_freshers_nnt.name }}" id="matinee_freshers_nnt" type="hidden" value="0">
						</div>
					{% elif report.category|stringformat:"s" == "External" %}
						<div class="input-field col s6">
							<input name="{{ S_form.number_fringe.name }}" id="fringe" type="number" class="validate" value="0" max="{{ report.how_many_left }}" min="0">
							<label for="{{ S_form.number_fringe.name }}">{{ S_form.number_fringe.label }}</label>
						</div>
					{% else %}
						<p class="white-text">This show does not have an appropriate category applied to it</p>
						<p class="white-text">{{ report.category }}, {{ report.cat_id }}</p>
					{% endif %}
				</div>
				<div class="row">
					<div class="col s12">
						<div class="card tiny grey darken-3 valign-wrapper">
							<div class="col s3">
								<span class="valign nnt-orange" id="sale-text">Total sales: <span class="nnt-orange bold">£{{ report.total_sales }}</span></span>
							</div>
							<div class="col s3">
								<span class="nnt-orange" id="sale-text">Order Total: <span class="bold">£</span><span class="bold" id="out"></span></span>
							</div>
							<div class="col s3">
								<button type="reset" class="btn nnt purple valign" onclick="resetButton()">Reset</button>
							</div>
							<div class="col s3"> 
							{% if report.how_many_left == 0 %}
								<button type="button" class="disabled btn nnt purple valign">Sell Tickets</button>
							{% else %}
								<button type="submit" class="btn nnt purple valign">Sell Tickets</button>
							{% endif %}
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>

		{% endif %}

		<!-- Occurrence Modal Structure -->
		<div id="picker-modal" class="modal bottom-sheet">
		    <div class="modal-content">
		    	<div class="row">
		        <h4>{{ show.name }}</h4>
		        {% for oc in occurrence %}
		        	<div class="col s12">
			        	<a href="/show/{{ show.id }}/{{ oc.0 }}" class="modal-action modal-close btn-flat">
			        	{{ show.name }} on <strong>{{ oc.2 }}</strong> at <strong>{{ oc.4 }}</strong>
		        		{% if oc.5 == 1 %}
			        		, <strong>{{ oc.5 }}</strong> ticket reserved
		        		{% else %}
			        		, <strong>{{ oc.5 }}</strong> tickets reserved
		        		{% endif %}
			        	</a>
		        	</div>
		        	<br>
	        	{% empty %}
	        		<div class="col s12">
			        	<span class="modal-action modal-close btn-flat">There are no showings available</span>
		        	</div>
		        {% endfor %}
		        </div>
		    </div>
			    
		</div>

		<!-- Reservation Modal Structure -->
		<div id="modal2" class="modal modal-fixed-footer">
		    <div class="modal-content">
				<h4>Reservations for {{ show.name }}</h4>
				<form action="." method="post">
				{% csrf_token %}
					<div class="row">
						<div class="col s12">
							<table class="highlight striped">
								<thead>
									<tr>
										<th data-field="name">Name</th>
										<th data-field="quantity">Quantity</th>
										<th data-field="select">Select</th>
									</tr>
								</thead>

								<tbody>
									{% for tick in report.tickets %}
										{% if tick.cancelled %}
										<tr id="cancelled">
											<th><strike>{{ tick.person_name }}</strike></th>
											<th class="grey-text"><strike>{{ tick.quantity }}</strike></th>
											<th><button type="button" class="btn disabled nnt purple">Add</button></th>
										</tr>
										{% else %}
										<tr>
											<th>{{ tick.person_name }}</th>
											<th class="teal-text">{{ tick.quantity }}</th>
											<th>
											<button type="submit" class="btn nnt purple" name="{{ R_form.ticket.name }}" value="{{ tick.person_name}}">
											Add
											</button>
											</th>
										</tr>
										{% endif %}
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</form>
		    </div>
		    <div class="modal-footer">
				<a class="modal-action modal-close waves-effect waves-green btn-flat ">Close</a>
		    </div>
		</div>

	</div>
	
	</main>

	<script>
		$(document).ready(function(){
	    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
		    $('.modal-trigger').leanModal({
		      dismissible: true, // Modal can be dismissed by clicking outside of the modal
		      opacity: .5, // Opacity of modal background
		      in_duration: 300, // Transition in duration
		      out_duration: 300, // Transition out duration
		    }
		  );
		});
	</script>

	<script>
	$(document).ready(function(){
	    $('input').keyup(function(){
	    	var concession_price = document.getElementById("concession_price").value;
	    	var public_price = document.getElementById("public_price").value;
	    	var fringe_price = document.getElementById("fringe_price").value;
	    	var external_price = document.getElementById("external_price").value;
	    	var matinee_freshers_price = document.getElementById("matinee_freshers_price").value;
	    	var matinee_freshers_nnt_price = document.getElementById("matinee_freshers_nnt_price").value;

	        var num_concession = document.getElementById("concession").value * concession_price;
	        var num_public = document.getElementById("public").value * public_price;
	        var num_fringe = document.getElementById("fringe").value * fringe_price;
	        var num_external = document.getElementById("external").value * external_price;
	        var num_matinee_freshers = document.getElementById("matinee_freshers").value * matinee_freshers_price;
	        var num_matinee_freshers_nnt = document.getElementById("matinee_freshers_nnt").value * matinee_freshers_nnt_price;
	        var num_season = document.getElementById("season").value * 0;
	        var num_fellow = document.getElementById("fellow").value * 0;

	        var x = +num_concession + +num_public + +num_fringe + +num_external + +num_matinee_freshers + +num_matinee_freshers_nnt + +num_season + +num_fellow;
	        document.getElementById("out").innerHTML = x;
	    });
	});
	</script>

	<script>
	function resetButton() {
		document.getElementById("out").innerHTML = 0;
	}
	</script>

	<script>
		$(document).ready(function(){
		  document.getElementById("out").innerHTML = 0;
		});
	</script>
</body>
</html>
